<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discord Embed Builder</title
  <style>
    /* Discord-like fonts */
    @font-face {
      font-family: 'gg sans';
      font-weight: 400;
      src: url(https://cdn.jsdelivr.net/gh/mahtoid/DiscordUtils@master/ggsans-400.woff2) format("woff2");
    }

    @font-face {
      font-family: 'gg sans';
      font-weight: 500;
      src: url(https://cdn.jsdelivr.net/gh/mahtoid/DiscordUtils@master/ggsans-500.woff2) format("woff2");
    }

    @font-face {
      font-family: 'gg sans';
      font-weight: 600;
      src: url(https://cdn.jsdelivr.net/gh/mahtoid/DiscordUtils@master/ggsans-600.woff2) format("woff2");
    }

    @font-face {
      font-family: 'gg sans';
      font-weight: 700;
      src: url(https://cdn.jsdelivr.net/gh/mahtoid/DiscordUtils@master/ggsans-700.woff2) format("woff2");
    }

    @font-face {
      font-family: 'gg sans';
      font-weight: 800;
      src: url(https://cdn.jsdelivr.net/gh/mahtoid/DiscordUtils@master/ggsans-800.woff2) format("woff2");
    }

    /* Discord-specific styles */
    body {
      font-family: 'gg sans', sans-serif;
      background-color: #36393f;
      color: #dcddde;
    }

    /* Discord Embed Styling */
    .discord-embed {
      max-width: 520px;
      margin: 0;
      position: relative;
    }

    .discord-embed-content {
      display: flex;
      margin-left: 4px;
    }

    .discord-embed-thumbnail {
      max-width: 80px;
      max-height: 80px;
      border-radius: 3px;
      flex-shrink: 0;
      margin-left: 16px;
      object-fit: contain;
      width: auto;
      height: auto;
    }

    .discord-embed-author {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      font-size: 14px;
      font-weight: 500;
      color: white;
    }

    .discord-embed-author-icon {
      margin-right: 8px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      object-fit: contain;
    }

    .discord-embed-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      line-height: 1.375;
    }

    .discord-embed-description {
      font-size: 14px;
      line-height: 1.375;
      margin-bottom: 10px;
      min-width: 0;
      white-space: pre-line;
    }

    .discord-embed-fields {
      display: flex;
      flex-wrap: wrap;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .discord-embed-field {
      flex: 0;
      min-width: 100%;
      max-width: 506px;
      padding-top: 4px;
      margin-bottom: 4px;
    }

    .discord-embed-field.inline {
      flex: 1;
      min-width: 150px;
      flex-basis: auto;
    }

    .discord-embed-field-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
      color: white;
    }

    .discord-embed-field-value {
      font-size: 14px;
      font-weight: 400;
      line-height: 1.3;
      white-space: pre-line;
      min-width: 0;
    }

    .discord-embed-image {
      max-width: 100%;
      margin-top: 8px;
      border-radius: 3px;
    }

    .discord-embed-footer {
      display: flex;
上げ
      align-items: center;
      font-size: 12px;
      margin-top: 8px;
      color: #acacac;
    }

    .discord-embed-footer-icon {
      block;
      align-items: center;
      font-size: 12px;
      margin-top: 8px;
      color: #acacac;
    }

    .discord-embed-footer-icon {
      margin-right: 8px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      object-fit: contain;
    }

    .discord-embed-left-border {
      background-color: #5865F2;
      width: 4px;
      border-radius: 4px 0 0 4px;
      flex-shrink: 0;
    }

    .discord-message {
      padding: 1rem 0.25rem;
      background-color: #36393f;
      border-radius: 4px;
      margin-bottom: 1rem;
    }

    .discord-message-content {
      font-size: 16px;
      line-height: 1.375;
      margin: 8px 0;
      word-wrap: break-word;
      white-space: break-spaces;
    }

    .discord-message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 16px;
    }

    .discord-message-header {
      display: flex;
      align-items: flex-start;
    }

    .discord-message-author {
      font-size: 16px;
      font-weight: 500;
      color: white;
      margin-right: 4px;
    }

    .discord-button {
      display: inline-flex;
      align-items: center;
      padding: 2px 16px;
      border-radius: 3px;
      font-size: 14px;
      font-weight: 500;
      line-height: 1.3;
      cursor: pointer;
      min-height: 32px;
      min-width: 60px;
      margin: 4px 8px 4px 0;
    }

    .discord-button.primary {
      background-color: #5865F2;
      color: white;
    }

    .discord-button.success {
      background-color: #3ba55d;
      color: white;
    }

    .discord-button.danger {
      background-color: #ed4245;
      color: white;
    }

    .discord-button.link {
      background-color: #4f545c;
      color: white;
      position: relative;
      padding-right: 32px;
    }
    
    .discord-button.link::after {
      content: "";
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5z' clip-rule='evenodd' /%3E%3Cpath fill-rule='evenodd' d='M6.194 12.753a.75.75 0 001.06.053L16.5 4.44v2.81a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5a.75.75 0 000 1.5h2.553l-9.056 8.194a.75.75 0 00-.053 1.06z' clip-rule='evenodd' /%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.8;
    }

    .discord-button.secondary {
      background-color: #4f545c;
      color: white;
    }

    .discord-action-row {
      display: flex;
      flex-wrap: wrap;
      margin: 4px 0;
    }

    .discord-select-menu {
      background-color: #4f545c;
      border-radius: 3px;
      min-height: 32px;
      min-width: 200px;
      max-width: 100%;
      position: relative;
      padding: 2px 16px;
      margin: 4px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    .discord-select-menu::after {
      content: "▼";
      font-size: 12px;
      margin-left: 4px;
    }

    /* Markdown styles */
    .markdown {
      max-width: 100%;
      line-height: 1.3;
      overflow-wrap: break-word;
    }

    .preserve-whitespace {
      white-space: pre-wrap;
    }

    .spoiler {
      background-color: #202225;
      color: transparent;
      cursor: pointer;
      padding: 0 2px;
      border-radius: 3px;
    }

    .spoiler:hover {
      color: white;
    }

    .mention {
      background-color: rgba(88, 101, 242, 0.3);
      color: #dee0fc;
      border-radius: 3px;
      padding: 0 2px;
      font-weight: 500;
    }

    .mention:hover {
      background-color: rgba(88, 101, 242, 0.6);
    }

    .code-block {
      background-color: #2f3136;
      border: 1px solid #202225;
      border-radius: 4px;
      padding: 8px;
      font-family: Consolas, "Courier New", monospace;
      margin: 6px 0;
      white-space: pre-wrap;
    }

    .inline-code {
      background-color: #2f3136;
      border-radius: 3px;
      padding: 0 3px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 85%;
    }

    .quote {
      border-left: 4px solid #4f545c;
      padding-left: 8px;
      margin: 4px 0;
    }

    /* Editor UI Improvements */
    .editor-section {
      background-color: #2f3136;
      border-radius: 5px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .section-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-primary {
      background-color: #5865F2;
    }

    .btn-secondary {
      background-color: #4f545c;
    }

    .btn-danger {
      background-color: #ed4245;
    }

    .btn-success {
      background-color: #3ba55d;
    }

    .btn {
      border-radius: 4px;
      padding: 6px 16px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .input-field {
      background-color: #40444b;
      border: none;
      border-radius: 4px;
      color: #dcddde;
      padding: 8px 12px;
      width: 100%;
      margin-bottom: 8px;
      font-family: 'gg sans', sans-serif;
    }

    .input-field:focus {
      outline: 2px solid #5865F2;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #2e3338;
    }

    ::-webkit-scrollbar-thumb {
      background: #202225;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #292b2f;
    }
    
    /* Collapsible sections */
    .collapsible-header {
      cursor: pointer;
      user-select: none;
    }
    
    .collapsible-header::after {
      content: "▼";
      margin-left: 8px;
      transition: transform 0.2s;
      display: inline-block;
      font-size: 12px;
    }
    
    .collapsible-header.collapsed::after {
      transform: rotate(-90deg);
    }
    
    .collapsible-content {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .collapsible-content.collapsed {
      max-height: 0;
    }
    
    /* Draggable items */
    .drag-handle {
      cursor: grab;
      color: #72767d;
    }
    
    .draggable-item.dragging {
      opacity: 0.7;
    }
    
    .sortable-ghost {
      background-color: #3f4249;
      border: 2px dashed #5865F2;
    }
  </style>
</head>
<body class="min-h-screen p-4">
  <div id="discord-webhook-builder" class="max-w-7xl mx-auto">
    <h1 class="text-2xl font-bold mb-4 text-white">Discord Embed Builder</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Builder Column -->
      <div class="flex flex-col">
        <!-- User Info Section -->
        <div id="message-settings-section" class="editor-section">
          <div class="section-title">Message Settings</div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input id="username" maxlength="80" type="text" placeholder="Username (optional)" class="input-field">
            <input id="avatar-url" type="text" placeholder="Avatar URL (optional)" class="input-field">
          </div>
          
          <div id="message-content-container" class="mb-4">
            <label class="block mb-1">Message Content <span id="char-count">(0/2000)</span></label>
            <textarea id="message-content" maxlength="2000" rows="3" class="input-field"></textarea>
          </div>
        </div>

        <!-- Embeds Section -->
        <div id="embeds-section" class="editor-section">
          <div class="section-title">
            <span>Embeds <span id="embed-count">(0/10)</span></span>
            <div class="flex gap-2">
              <button id="add-embed" class="btn btn-primary">Add Embed</button>
              <button id="delete-all-embeds" class="btn btn-danger" onclick="deleteAllEmbeds()">Delete All</button>
            </div>
          </div>
          <div id="embeds-container" class="space-y-4"></div>
        </div>

        <!-- Buttons Section -->
        <div id="buttons-section" class="editor-section">
          <div class="section-title">
            <span>Buttons <span id="button-count">(0/5)</span></span>
            <div class="flex gap-2">
              <button id="add-button" class="btn btn-primary">Add Button</button>
              <button id="delete-all-buttons" class="btn btn-danger" onclick="deleteAllButtons()">Delete All</button>
            </div>
          </div>
          <div id="buttons-container" class="space-y-4"></div>
        </div>
      </div>

      <!-- Preview Column -->
      <div class="flex flex-col">
        <div class="editor-section">
          <div class="section-title">
            <span>Preview</span>
            <div class="flex gap-2">
              <button id="toggle-preview" class="btn btn-secondary">Switch to JSON</button>
              <button id="copy-json" class="btn btn-success" onclick="copyJsonToClipboard()">📋 Copy JSON</button>
              <button id="clear-all" class="btn btn-danger" onclick="clearAllData()">🧹 Clear All</button>
            </div>
          </div>
          
          <div id="live-preview" class="bg-[#36393f] p-4 rounded border border-gray-700"></div>
          
          <div id="json-preview" class="bg-[#2b2d31] p-2 rounded border border-gray-700 h-[32rem] overflow-auto hidden">
            <textarea id="json-output" class="w-full h-full bg-transparent font-mono p-2 text-sm resize-none" readonly></textarea>
          </div>
        </div>
      </div>
    </div>

<script>
    // State management
    const state = {
      embeds: [],
      buttons: [],
      previewMode: "live"
    };

    // Default avatar for preview
    const defaultAvatar = "https://cdn.discordapp.com/embed/avatars/0.png";

    // DOM Elements
    const elements = {
      content: document.getElementById("message-content"),
      username: document.getElementById("username"),
      avatarUrl: document.getElementById("avatar-url"),
      messageContentContainer: document.getElementById("message-content-container"),
      embedsContainer: document.getElementById("embeds-container"),
      buttonsContainer: document.getElementById("buttons-container"),
      livePreview: document.getElementById("live-preview"),
      jsonPreview: document.getElementById("json-preview"),
      jsonOutput: document.getElementById("json-output"),
      embedsSection: document.getElementById("embeds-section"),
      buttonsSection: document.getElementById("buttons-section"),
      charCount: document.getElementById("char-count"),
      embedCount: document.getElementById("embed-count"),
      buttonCount: document.getElementById("button-count"),
      togglePreview: document.getElementById("toggle-preview"),
      addEmbed: document.getElementById("add-embed"),
      addButton: document.getElementById("add-button"),
      clearAll: document.getElementById("clear-all"),
      copyJson: document.getElementById("copy-json")
    };

    // Utility Functions
    function htmlSafe(str) {
      if (str === undefined || str === null) return '';
      return String(str).replace(/&/g, '&').replace(/</g, '<').replace(/>/g, '>').replace(/"/g, '"');
    }

    function parseMarkdown(text) {
      if (!text) return '';
      
      let html = text;
      html = html.replace(/```([\s\S]*?)```/g, '<div class="code-block">$1</div>');
      html = html.replace(/`([^`]+)`/g, '<span class="inline-code">$1</span>');
      html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
      html = html.replace(/_(.*?)_/g, '<em>$1</em>');
      html = html.replace(/__(.*?)__/g, '<u>$1</u>');
      html = html.replace(/~~(.*?)~~/g, '<del>$1</del>');
      html = html.replace(/^> (.+)$/gm, '<div class="quote">$1</div>');
      html = html.replace(/\|\|(.*?)\|\|/g, '<span class="spoiler">$1</span>');
      html = html.replace(/@(everyone|here)/g, '<span class="mention">@$1</span>');
      html = html.replace(/<@!?(\d+)>/g, '<span class="mention">@user</span>');
      html = html.replace(/<#(\d+)>/g, '<span class="mention">#channel</span>');
      html = html.replace(/<@&(\d+)>/g, '<span class="mention">@role</span>');
      html = html.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" class="text-[#00b0f4] hover:underline">$1</a>');
      html = html.replace(/
/g, '<br>');
      return html;
    }
    
    function isValidEmoji(str) {
      const emojiRegex = /^(?:[\u{1F300}-\u{1F5FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}]|\u{200D}[\u{1F300}-\u{1F5FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}])*[\u{FE0F}]?$/u;
      return str && str.trim().length <= 10 && emojiRegex.test(str.trim());
    }
    
    function toggleCollapsible(header) {
      header.classList.toggle('collapsed');
      const content = header.nextElementSibling;
      if (content.classList.contains('collapsible-content')) {
        content.classList.toggle('collapsed');
        if (content.classList.contains('collapsed')) {
          content.style.maxHeight = '0';
        } else {
          content.style.maxHeight = `${content.scrollHeight}px`;
        }
      }
    }
    
    function setupSortable(element, onEnd) {
      if (!element) return;
      new Sortable(element, {
        animation: 150,
        handle: '.drag-handle',
        ghostClass: 'sortable-ghost',
        onEnd: onEnd
      });
    }

    function renderPreview() {
      if (state.previewMode !== 'live') return;
      
      const username = elements.username.value || 'Discord User';
      const avatarUrl = elements.avatarUrl.value || defaultAvatar;
      const content = elements.content.value;
      
      let html = `
        <div class="discord-message">
          <div class="discord-message-header">
            <img src="${htmlSafe(avatarUrl)}" class="discord-message-avatar" onerror="this.src='${defaultAvatar}'" />
            <div>
              <span class="discord-message-author">${htmlSafe(username)}</span>
              <span class="text-xs text-gray-400">Today at ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>
            </div>
          </div>
      `;
      
      if (content) {
        html += `<div class="discord-message-content">${parseMarkdown(content)}</div>`;
      }
      
      if (state.embeds && state.embeds.length > 0) {
        state.embeds.forEach(embed => {
          const colorHex = embed.color ? '#' + embed.color.toString(16).padStart(6, '0') : '#5865F2';
          html += `
            <div class="discord-embed" style="margin-top: 8px;">
              <div class="discord-embed-content">
                <div class="discord-embed-left-border" style="background-color: ${colorHex};"></div>
                <div style="padding: 8px 10px; flex-grow: 1;">
          `;
          
          if (embed.author && embed.author.name) {
            html += `
              <div class="discord-embed-author">
                ${embed.author.icon_url ? `<img src="${htmlSafe(embed.author.icon_url)}" class="discord-embed-author-icon" onerror="this.style.display='none'"/>` : ''}
                ${embed.author.url ? `<a href="${htmlSafe(embed.author.url)}" target="_blank" class="text-white hover:underline">` : ''}
                ${htmlSafe(embed.author.name)}
                ${embed.author.url ? `</a>` : ''}
              </div>
            `;
          }
          
          if (embed.title) {
            html += `
              <div class="discord-embed-title">
                ${embed.url ? `<a href="${htmlSafe(embed.url)}" target="_blank" class="text-[#00b0f4] hover:underline">` : ''}
                ${htmlSafe(embed.title)}
                ${embed.url ? `</a>` : ''}
              </div>
            `;
          }
          
          if (embed.description) {
            html += `<div class="discord-embed-description">${parseMarkdown(embed.description)}</div>`;
          }
          
          if (embed.fields && embed.fields.length > 0) {
            html += `<div class="discord-embed-fields">`;
            embed.fields.forEach(field => {
              html += `
                <div class="discord-embed-field ${field.inline ? 'inline' : ''}">
                  <div class="discord-embed-field-name">${htmlSafe(field.name)}</div>
                  <div class="discord-embed-field-value">${parseMarkdown(field.value)}</div>
                </div>
              `;
            });
            html += `</div>`;
          }
          
          if (embed.image && embed.image.url) {
            html += `<img src="${htmlSafe(embed.image.url)}" class="discord-embed-image" onerror="this.style.display='none'"/>`;
          }
          
          if ((embed.footer && embed.footer.text) || embed.timestamp) {
            html += `<div class="discord-embed-footer">`;
            if (embed.footer && embed.footer.text) {
              if (embed.footer.icon_url) {
                html += `<img src="${htmlSafe(embed.footer.icon_url)}" class="discord-embed-footer-icon" onerror="this.style.display='none'"/>`;
              }
              html += `<span>${htmlSafe(embed.footer.text)}</span>`;
            }
            if (embed.timestamp) {
              const date = new Date(embed.timestamp);
              const formattedDate = date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
              }) + ' at ' + date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
              });
              if (embed.footer && embed.footer.text) {
                html += ' • ';
              }
              html += `<span>${formattedDate}</span>`;
            }
            html += `</div>`;
          }
          
          html += `</div>`;
          if (embed.thumbnail && embed.thumbnail.url) {
            html += `<img src="${htmlSafe(embed.thumbnail.url)}" class="discord-embed-thumbnail" onerror="this.style.display='none'"/>`;
          }
          html += `</div></div>`;
        });
      }
      
      if (state.buttons && state.buttons.length > 0) {
        html += `<div class="discord-action-row">`;
        state.buttons.forEach(button => {
          const buttonStyleClass = {
            1: 'primary',
            2: 'secondary',
            3: 'success',
            4: 'danger',
            5: 'link'
          }[button.style] || 'secondary';
          html += `
            <div class="discord-button ${buttonStyleClass}">
              ${button.emoji && isValidEmoji(button.emoji) ? `<span class="mr-2">${button.emoji}</span>` : ''}
              ${htmlSafe(button.label || 'Button')}
            </div>
          `;
        });
        html += `</div>`;
      }
      
      html += `</div>`;
      elements.livePreview.innerHTML = html;
    }

    function copyJsonToClipboard() {
      const jsonOutput = document.getElementById("json-output");
      const jsonText = jsonOutput.value;
      const copyButton = document.getElementById('copy-json');
      const originalText = copyButton.textContent;
      
      if (state.previewMode !== 'json') {
        state.previewMode = 'json';
        elements.livePreview.classList.add('hidden');
        elements.jsonPreview.classList.remove('hidden');
        elements.togglePreview.textContent = 'Switch to Live Preview';
        updateJSON();
      }
      
      const tempTextArea = document.createElement('textarea');
      tempTextArea.value = jsonText;
      tempTextArea.setAttribute('readonly', '');
      tempTextArea.style.position = 'absolute';
      tempTextArea.style.left = '-9999px';
      document.body.appendChild(tempTextArea);
      tempTextArea.select();
      
      let copySuccess = false;
      
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(jsonText)
          .then(() => {
            copyButton.textContent = '✓ Copied!';
            setTimeout(() => {
              copyButton.textContent = '📋 Copy JSON';
            }, 2000);
          })
          .catch(err => {
            console.error('Clipboard API failed:', err);
            fallbackCopy();
          });
      } else {
        fallbackCopy();
      }
      
      function fallbackCopy() {
        try {
          copySuccess = document.execCommand('copy');
          if (copySuccess) {
            copyButton.textContent = '✓ Copied!';
            setTimeout(() => {
              copyButton.textContent = '📋 Copy JSON';
            }, 2000);
          } else {
            jsonOutput.focus();
            jsonOutput.select();
            copyButton.textContent = 'Select & Copy';
            setTimeout(() => {
              copyButton.textContent = '📋 Copy JSON';
            }, 2000);
          }
        } catch (err) {
          console.error('Copy failed:', err);
          jsonOutput.focus();
          jsonOutput.select();
        }
      }
      
      document.body.removeChild(tempTextArea);
    }
    
    function clearAllData() {
      elements.username.value = '';
      elements.avatarUrl.value = '';
      elements.content.value = '';
      elements.charCount.textContent = '(0/2000)';
      state.embeds = [];
      state.buttons = [];
      elements.embedsContainer.innerHTML = '';
      elements.buttonsContainer.innerHTML = '';
      elements.embedCount.textContent = '(0/10)';
      elements.buttonCount.textContent = '(0/5)';
      renderEmbeds();
      renderButtons();
      renderPreview();
      updateJSON();
    }
    
    function updateJSON() {
      let jsonData = {};
      
      const content = elements.content.value;
      if (content) jsonData.content = content;
      
      if (state.embeds && state.embeds.length > 0) {
        jsonData.embeds = state.embeds.map(embed => {
          const cleanEmbed = {};
          if (embed.title) cleanEmbed.title = embed.title;
          if (embed.description) cleanEmbed.description = embed.description;
          if (embed.url) cleanEmbed.url = embed.url;
          if (embed.color !== undefined) cleanEmbed.color = embed.color;
          if (embed.timestamp) cleanEmbed.timestamp = embed.timestamp;
          if (embed.author && embed.author.name) {
            cleanEmbed.author = { name: embed.author.name };
            if (embed.author.url) cleanEmbed.author.url = embed.author.url;
            if (embed.author.icon_url) cleanEmbed.author.icon_url = embed.author.icon_url;
          }
          if (embed.thumbnail && embed.thumbnail.url) {
            cleanEmbed.thumbnail = { url: embed.thumbnail.url };
          }
          if (embed.image && embed.image.url) {
            cleanEmbed.image = { url: embed.image.url };
          }
          if (embed.footer && (embed.footer.text || embed.footer.icon_url)) {
            cleanEmbed.footer = {};
            if (embed.footer.text) cleanEmbed.footer.text = embed.footer.text;
            if (embed.footer.icon_url) cleanEmbed.footer.icon_url = embed.footer.icon_url;
          }
          if (embed.fields && embed.fields.length > 0) {
            cleanEmbed.fields = embed.fields.filter(field => field.name && field.value).map(field => ({
              name: field.name,
              value: field.value,
              inline: !!field.inline
            }));
          }
          return cleanEmbed;
        });
      }
      
      if (state.buttons && state.buttons.length > 0) {
        jsonData.components = [{
          type: 1,
          components: state.buttons.map(button => {
            const component = {
              type: 2,
              style: button.style || 5,
              label: button.label || 'Button',
              url: button.url || 'https://example.com'
            };
            if (button.emoji && isValidEmoji(button.emoji)) {
              component.emoji = { name: button.emoji };
            }
            return component;
          })
        }];
      }
      
      const jsonStr = JSON.stringify(jsonData, null, 2);
      elements.jsonOutput.value = jsonStr;
      
      elements.jsonOutput.addEventListener('mousedown', function(e) {
        const selection = window.getSelection();
        if (selection.type !== 'Range') {
          elements.jsonOutput.select();
        }
      });
    }

    function updateTimestampInput(embedIdx) {
      const timestampInput = document.querySelector(`#embeds-container div[data-id="${embedIdx}"] input[type="datetime-local"]`);
      if (timestampInput) {
        timestampInput.value = state.embeds[embedIdx].timestamp ? new Date(state.embeds[embedIdx].timestamp).toISOString().slice(0, 16) : '';
      }
    }

    function renderEmbeds() {
      elements.embedsContainer.innerHTML = "";
      const embedsListDiv = document.createElement("div");
      embedsListDiv.id = "sortable-embeds-list";
      embedsListDiv.className = "space-y-4";
      elements.embedsContainer.appendChild(embedsListDiv);
      
      state.embeds.forEach((embed, i) => {
        if (!embed.customName) embed.customName = '';
        
        const embedDiv = document.createElement("div");
        embedDiv.className = "bg-[#2b2d31] rounded-lg border border-gray-700 draggable-item";
        embedDiv.dataset.id = i;
        
        const headerDiv = document.createElement("div");
        headerDiv.className = `flex items-center p-3 bg-[#2f3136] rounded-t-lg cursor-pointer collapsible-header ${embed.collapsed ? 'collapsed' : ''}`;
        headerDiv.innerHTML = `
          <div class="drag-handle mr-2">
            <span class="text-xl">⋮⋮</span>
          </div>
          <div class="w-3 h-16 mr-2 rounded-l" style="background-color: ${embed.color !== undefined ? '#' + embed.color.toString(16).padStart(6, '0') : '#5865F2'};"></div>
          <div class="flex-grow">
            <span class="font-bold">${i + 1}. </span>
            <input type="text" 
              class="bg-[#2f3136] border-b border-gray-500 px-1 text-white w-48" 
              placeholder="Embed name (optional)"
              value="${htmlSafe(embed.customName)}" 
              onclick="event.stopPropagation()"
              oninput="state.embeds[${i}].customName = this.value; renderPreview(); updateJSON()">
            <span class="text-gray-400 text-sm ml-2">${embed.title ? embed.title.substring(0, 15) + (embed.title.length > 15 ? '...' : '') : ''}</span>
          </div>
          <div class="flex">
            <button class="toggle-collapse mr-2 text-xs py-1 px-2 bg-[#4f545c] rounded hover:bg-[#5d6269]">
              ${embed.collapsed ? 'Expand' : 'Collapse'}
            </button>
            <button onclick="removeEmbed(${i}); event.stopPropagation();" class="btn btn-danger text-xs py-1 px-2">✕</button>
          </div>
        `;
        
        headerDiv.querySelector('.toggle-collapse').addEventListener('click', (e) => {
          e.stopPropagation();
          state.embeds[i].collapsed = !state.embeds[i].collapsed;
          renderEmbeds();
        });
        
        headerDiv.addEventListener('click', () => {
          state.embeds[i].collapsed = !state.embeds[i].collapsed;
          renderEmbeds();
        });
        
        embedDiv.appendChild(headerDiv);
        
        if (!embed.collapsed) {
          const contentDiv = document.createElement("div");
          contentDiv.className = `p-4 collapsible-content ${embed.collapsed ? 'collapsed' : ''}`;
          contentDiv.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-4">
              <input type="text" class="input-field" placeholder="Title (256)" maxlength="256" value="${htmlSafe(embed.title || '')}"
                    oninput="state.embeds[${i}].title = this.value; renderPreview(); updateJSON()">
              <input type="url" class="input-field" placeholder="Title URL" value="${htmlSafe(embed.url || '')}"
                    oninput="state.embeds[${i}].url = this.value; renderPreview(); updateJSON()">
              <div class="flex justify-between items-center py-2 px-3 bg-[#2b2d31] rounded mb-2">
                <label class="text-sm" style="color: ${embed.color !== undefined ? '#' + embed.color.toString(16).padStart(6, '0') : '#5865F2'}">
                  Color
                </label>
                <input type="color" class="h-8 w-10 cursor-pointer" title="Color" value="${embed.color !== undefined ? '#' + embed.color.toString(16).padStart(6, '0') : '#5865F2'}"
                      oninput="state.embeds[${i}].color = parseInt(this.value.replace('#', ''), 16); 
                               this.parentElement.querySelector('label').style.color = this.value;
                               renderPreview(); updateJSON()">
              </div>
            </div>
            <div class="mb-4">
              <label class="text-sm mb-1 block">Description</label>
              <textarea class="input-field" rows="3" placeholder="Description (2000)" maxlength="2000" 
                        oninput="state.embeds[${i}].description = this.value; renderPreview(); updateJSON()">${htmlSafe(embed.description || '')}</textarea>
            </div>
            <div class="mb-4">
              <div class="font-bold text-sm mb-2">Author</div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                <input type="text" class="input-field" placeholder="Name" maxlength="256"
                      value="${htmlSafe((embed.author || {}).name || '')}"
                      oninput="if(!state.embeds[${i}].author)state.embeds[${i}].author={};state.embeds[${i}].author.name=this.value; renderPreview(); updateJSON()">
                <input type="url" class="input-field" placeholder="URL"
                      value="${htmlSafe((embed.author || {}).url || '')}"
                      oninput="if(!state.embeds[${i}].author)state.embeds[${i}].author={};state.embeds[${i}].author.url=this.value; renderPreview(); updateJSON()">
              </div>
              <input type="url" class="input-field" placeholder="Icon URL"
                    value="${htmlSafe((embed.author || {}).icon_url || '')}"
                    oninput="if(!state.embeds[${i}].author)state.embeds[${i}].author={};state.embeds[${i}].author.icon_url=this.value; renderPreview(); updateJSON()">
            </div>
            <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <div class="font-bold text-sm mb-2">Thumbnail</div>
                <input type="url" class="input-field" placeholder="Thumbnail URL"
                      value="${htmlSafe((embed.thumbnail || {}).url || '')}"
                      oninput="if(!state.embeds[${i}].thumbnail)state.embeds[${i}].thumbnail={};state.embeds[${i}].thumbnail.url=this.value; renderPreview(); updateJSON()">
              </div>
              <div>
                <div class="font-bold text-sm mb-2">Image</div>
                <input type="url" class="input-field" placeholder="Image URL"
                      value="${htmlSafe((embed.image || {}).url || '')}"
                      oninput="if(!state.embeds[${i}].image)state.embeds[${i}].image={};state.embeds[${i}].image.url=this.value; renderPreview(); updateJSON()">
              </div>
            </div>
            <div class="mb-4">
              <div class="flex justify-between items-center mb-2">
                <span class="font-bold text-sm">Fields (${(embed.fields || []).length}/25)</span>
                <button onclick="addField(${i})" class="btn btn-primary text-sm">+ Add Field</button>
              </div>
              <div id="fields-${i}" class="space-y-2"></div>
            </div>
            <div class="mb-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <div class="font-bold text-sm mb-2">Footer</div>
                  <input type="text" class="input-field" placeholder="Text" maxlength="2000"
                        value="${htmlSafe((embed.footer || {}).text || '')}"
                        oninput="if(!state.embeds[${i}].footer)state.embeds[${i}].footer={};state.embeds[${i}].footer.text=this.value; renderPreview(); updateJSON()">
                  <input type="url" class="input-field mt-2" placeholder="Footer Icon URL"
                        value="${htmlSafe((embed.footer || {}).icon_url || '')}"
                        oninput="if(!state.embeds[${i}].footer)state.embeds[${i}].footer={};state.embeds[${i}].footer.icon_url=this.value; renderPreview(); updateJSON()">
                </div>
                <div>
                  <div class="font-bold text-sm mb-2">Timestamp</div>
                  <div class="mb-2">
                    <input type="datetime-local" class="input-field w-full text-white" style="color-scheme: dark;"
                          value="${embed.timestamp ? new Date(embed.timestamp).toISOString().slice(0, 16) : ''}"
                          oninput="state.embeds[${i}].timestamp = this.value ? new Date(this.value).toISOString() : ''; renderPreview(); updateJSON(); updateTimestampInput(${i})">
                  </div>
                  <div class="flex gap-2">
                    <button onclick="state.embeds[${i}].timestamp = (new Date()).toISOString(); updateTimestampInput(${i}); renderPreview(); updateJSON()" 
                            class="btn btn-primary text-sm flex-1">Time Now</button>
                    <button onclick="state.embeds[${i}].timestamp = ''; updateTimestampInput(${i}); renderPreview(); updateJSON()" 
                            class="btn btn-secondary text-sm flex-1">Reset Time</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          embedDiv.appendChild(contentDiv);
          setTimeout(() => {
            if (!embed.collapsed) {
              contentDiv.style.maxHeight = `${contentDiv.scrollHeight}px`;
            } else {
              contentDiv.style.maxHeight = '0';
            }
          }, 0);
        }
        
        embedsListDiv.appendChild(embedDiv);
        
        if (!embed.collapsed) {
          renderFields(i);
        }
      });
      
      setupSortable(document.getElementById("sortable-embeds-list"), (evt) => {
        const oldIndex = evt.oldIndex;
        const newIndex = evt.newIndex;
        if (oldIndex !== newIndex) {
          const item = state.embeds[oldIndex];
          state.embeds.splice(oldIndex, 1);
          state.embeds.splice(newIndex, 0, item);
          renderPreview();
          updateJSON();
        }
      });
      
      elements.embedCount.textContent = `(${state.embeds.length}/10)`;
      renderPreview();
      updateJSON();
    }

    function renderFields(embedIdx) {
      const embed = state.embeds[embedIdx];
      if (!embed.fields) embed.fields = [];
      
      const fieldsDiv = document.getElementById(`fields-${embedIdx}`);
      fieldsDiv.innerHTML = "";
      
      embed.fields.forEach((field, fIdx) => {
        const fieldDiv = document.createElement("div");
        fieldDiv.className = "p-2 bg-[#2b2d31] rounded draggable-item";
        fieldDiv.dataset.id = fIdx;
        
        fieldDiv.innerHTML = `
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="drag-handle col-span-1">
              <span class="text-xl">⋮⋮</span>
            </div>
            <input type="text" placeholder="Name (256)" maxlength="256"
              class="input-field col-span-4"
              value="${htmlSafe(field.name || '')}"
              oninput="state.embeds[${embedIdx}].fields[${fIdx}].name = this.value; renderPreview(); updateJSON()">
            <input type="text" placeholder="Value (1024)" maxlength="1024"
              class="input-field col-span-4"
              value="${htmlSafe(field.value || '')}"
              oninput="state.embeds[${embedIdx}].fields[${fIdx}].value = this.value; renderPreview(); updateJSON()">
            <div class="flex items-center col-span-2">
              <input type="checkbox" id="field-inline-${embedIdx}-${fIdx}" class="mr-1"
                oninput="state.embeds[${embedIdx}].fields[${fIdx}].inline = this.checked; renderPreview(); updateJSON()"
                ${field.inline ? "checked" : ""}>
              <label for="field-inline-${embedIdx}-${fIdx}" class="text-xs">Inline</label>
            </div>
            <button onclick="removeField(${embedIdx}, ${fIdx})"
              class="btn btn-danger text-xs col-span-1">×</button>
          </div>
        `;
        
        fieldsDiv.appendChild(fieldDiv);
      });
      
      setupSortable(fieldsDiv, (evt) => {
        const fields = [...state.embeds[embedIdx].fields];
        const oldIndex = evt.oldIndex;
        const newIndex = evt.newIndex;
        if (oldIndex !== newIndex) {
          const item = fields[oldIndex];
          fields.splice(oldIndex, 1);
          fields.splice(newIndex, 0, item);
          state.embeds[embedIdx].fields = fields;
          renderPreview();
          updateJSON();
        }
      });
    }
    
    function renderButtons() {
      elements.buttonsContainer.innerHTML = "";
      const buttonsListDiv = document.createElement("div");
      buttonsListDiv.id = "sortable-buttons-list";
      buttonsListDiv.className = "space-y-4";
      elements.buttonsContainer.appendChild(buttonsListDiv);
      
      state.buttons.forEach((button, bIdx) => {
        if (!button.collapsed) button.collapsed = false;
        if (!button.customName) button.customName = '';
        
        const buttonDiv = document.createElement("div");
        buttonDiv.className = "bg-[#2b2d31] rounded-lg border border-gray-700 draggable-item";
        buttonDiv.dataset.id = bIdx;
        
        const headerDiv = document.createElement("div");
        headerDiv.className = `flex items-center p-3 bg-[#2f3136] rounded-t-lg cursor-pointer collapsible-header ${button.collapsed ? 'collapsed' : ''}`;
        headerDiv.innerHTML = `
          <div class="drag-handle mr-2">
            <span class="text-xl">⋮⋮</span>
          </div>
          <div class="flex-grow">
            <span class="font-bold">${bIdx + 1}. </span>
            <input type="text" 
              class="bg-[#2f3136] border-b border-gray-500 px-1 text-white w-48" 
              placeholder="Button name (optional)"
              value="${htmlSafe(button.customName)}"
              onclick="event.stopPropagation()"
              oninput="state.buttons[${bIdx}].customName = this.value; renderPreview(); updateJSON()">
            <span class="text-gray-400 text-sm ml-2">${button.emoji && isValidEmoji(button.emoji) ? button.emoji : ''}</span>
          </div>
          <div class="flex">
            <button class="toggle-collapse mr-2 text-xs py-1 px-2 bg-[#4f545c] rounded hover:bg-[#5d6269]">
              ${button.collapsed ? 'Expand' : 'Collapse'}
            </button>
            <button onclick="removeButton(${bIdx}); event.stopPropagation();" class="btn btn-danger text-xs py-1 px-2">✕</button>
          </div>
        `;
        
        headerDiv.querySelector('.toggle-collapse').addEventListener('click', (e) => {
          e.stopPropagation();
          state.buttons[bIdx].collapsed = !state.buttons[bIdx].collapsed;
          renderButtons();
        });
        
        headerDiv.addEventListener('click', () => {
          state.buttons[bIdx].collapsed = !state.buttons[bIdx].collapsed;
          renderButtons();
        });
        
        buttonDiv.appendChild(headerDiv);
        
        if (!button.collapsed) {
          const contentDiv = document.createElement("div");
          contentDiv.className = `p-4 collapsible-content ${button.collapsed ? 'collapsed' : ''}`;
          contentDiv.innerHTML = `
            <div class="grid grid-cols-1 gap-2 mb-4">
              <div class="relative">
                <input type="text" class="input-field emoji-input focus:outline focus:outline-2 focus:outline-[#5865F2]" placeholder="Emoji (optional)" maxlength="10" value="${htmlSafe(button.emoji || '')}"
                      oninput="validateEmojiInput(this, ${bIdx});">
                <span class="emoji-error text-red-400 text-xs hidden mt-1 block">Please enter a valid emoji</span>
              </div>
              <input type="text" class="input-field" placeholder="Button (80)" maxlength="80" value="${htmlSafe(button.label || '')}"
                    oninput="state.buttons[${bIdx}].label = this.value; renderPreview(); updateJSON()">
              <input type="url" class="input-field" placeholder="Button URL" value="${htmlSafe(button.url || '')}"
                    oninput="state.buttons[${bIdx}].url = this.value; renderPreview(); updateJSON()">
            </div>
          `;
          buttonDiv.appendChild(contentDiv);
          
          setTimeout(() => {
            if (!button.collapsed) {
              contentDiv.style.maxHeight = `${contentDiv.scrollHeight}px`;
            } else {
              contentDiv.style.maxHeight = '0';
            }
          }, 0);
        }
        
        buttonsListDiv.appendChild(buttonDiv);
      });
      
      setupSortable(document.getElementById("sortable-buttons-list"), (evt) => {
        const oldIndex = evt.oldIndex;
        const newIndex = evt.newIndex;
        if (oldIndex !== newIndex) {
          const item = state.buttons[oldIndex];
          state.buttons.splice(oldIndex, 1);
          state.buttons.splice(newIndex, 0, item);
          renderButtons();
          renderPreview();
          updateJSON();
        }
      });
      
      elements.buttonCount.textContent = `(${state.buttons.length}/5)`;
      renderPreview();
      updateJSON();
    }

    function validateEmojiInput(input, buttonIdx) {
      const value = input.value.trim();
      const errorSpan = input.nextElementSibling;
      
      try {
        if (value === '' || isValidEmoji(value)) {
          input.classList.remove('border-red-500');
          input.classList.add('border-transparent');
          errorSpan.classList.add('hidden');
          state.buttons[buttonIdx].emoji = value;
        } else {
          input.classList.add('border-red-500');
          input.classList.remove('border-transparent');
          errorSpan.classList.remove('hidden');
          state.buttons[buttonIdx].emoji = '';
        }
      } catch (err) {
        console.error('Emoji validation error:', err);
        input.classList.add('border-red-500');
        input.classList.remove('border-transparent');
        errorSpan.classList.remove('hidden');
        state.buttons[buttonIdx].emoji = '';
      }
      
      renderButtons();
      renderPreview();
      updateJSON();
    }

    window.addEmbed = () => {
      if (state.embeds.length < 10) {
        state.embeds.push({
          title: '',
          description: '',
          color: 0x5865F2,
          fields: []
        });
        renderEmbeds();
      }
    };

    window.removeEmbed = (idx) => {
      state.embeds.splice(idx, 1);
      renderEmbeds();
    };
    
    window.moveEmbed = (idx, direction) => {
      if (direction === 'up' && idx > 0) {
        const temp = state.embeds[idx];
        state.embeds[idx] = state.embeds[idx - 1];
        state.embeds[idx - 1] = temp;
      } else if (direction === 'down' && idx < state.embeds.length - 1) {
        const temp = state.embeds[idx];
        state.embeds[idx] = state.embeds[idx + 1];
        state.embeds[idx + 1] = temp;
      }
      renderEmbeds();
    };

    window.addField = (embedIdx) => {
      const embed = state.embeds[embedIdx];
      if (!embed.fields) embed.fields = [];
      if (embed.fields.length < 25) {
        embed.fields.push({
          name: '',
          value: '',
          inline: false
        });
        renderFields(embedIdx);
        renderPreview();
        updateJSON();
      }
    };

    window.removeField = (embedIdx, fieldIdx) => {
      state.embeds[embedIdx].fields.splice(fieldIdx, 1);
      renderFields(embedIdx);
      renderPreview();
      updateJSON();
    };
    
    window.addSingleButton = () => {
      if (state.buttons.length < 5) {
        state.buttons.push({
          label: 'Button',
          emoji: '',
          url: 'https://example.com',
          style: 5,
          customName: ''
        });
        renderButtons();
        renderPreview();
        updateJSON();
      }
    };
    
    window.removeButton = (buttonIdx) => {
      state.buttons.splice(buttonIdx, 1);
      renderButtons();
      renderPreview();
      updateJSON();
    };
    
    window.toggleCollapsible = toggleCollapsible;
    
    function deleteAllEmbeds() {
      state.embeds = [];
      document.getElementById("embeds-container").innerHTML = '';
      document.getElementById("embed-count").textContent = '(0/10)';
      renderPreview();
      updateJSON();
    }
    
    function deleteAllButtons() {
      state.buttons = [];
      document.getElementById("buttons-container").innerHTML = '';
      document.getElementById("button-count").textContent = '(0/5)';
      renderPreview();
      updateJSON();
    }

    elements.content.addEventListener('input', () => {
      elements.charCount.textContent = `(${elements.content.value.length}/2000)`;
      renderPreview();
      updateJSON();
    });

    elements.username.addEventListener('input', renderPreview);
    elements.avatarUrl.addEventListener('input', renderPreview);

    elements.togglePreview.addEventListener('click', () => {
      state.previewMode = state.previewMode === 'live' ? 'json' : 'live';
      
      elements.livePreview.classList.toggle('hidden', state.previewMode === 'json');
      elements.jsonPreview.classList.toggle('hidden', state.previewMode === 'live');
      
      elements.togglePreview.textContent = state.previewMode === 'live' 
        ? 'Switch to JSON' 
        : 'Switch to Live Preview';
        
      if (state.previewMode === 'json') {
        updateJSON();
      } else {
        renderPreview();
      }
    });

    elements.addEmbed.addEventListener('click', () => {
      window.addEmbed();
    });
    
    document.getElementById('delete-all-embeds').addEventListener('click', () => {
      window.deleteAllEmbeds();
    });

    elements.addButton.addEventListener('click', () => {
      window.addSingleButton();
    });

    document.getElementById('delete-all-buttons').addEventListener('click', () => {
      window.deleteAllButtons();
    });

    elements.clearAll.addEventListener('click', () => {
      elements.username.value = '';
      elements.avatarUrl.value = '';
      elements.content.value = '';
      elements.charCount.textContent = '(0/2000)';
      
      state.embeds = [];
      state.buttons = [];
      
      elements.embedsContainer.innerHTML = '';
      elements.buttonsContainer.innerHTML = '';
      elements.embedCount.textContent = '(0/10)';
      elements.buttonCount.textContent = '(0/5)';
      
      renderEmbeds();
      renderButtons();
      renderPreview();
      updateJSON();
    });

    elements.copyJson.addEventListener('click', () => {
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(elements.jsonOutput.value)
            .then(() => {
              const originalText = elements.copyJson.textContent;
              elements.copyJson.textContent = '✅ Copied!';
              
              setTimeout(() => {
                elements.copyJson.textContent = originalText;
              }, 2000);
            })
            .catch(err => {
              console.error('Clipboard API failed:', err);
              copyWithExecCommand();
            });
        } else {
          copyWithExecCommand();
        }
      } catch (err) {
        console.error('Copy failed:', err);
        alert('Copy failed. Please select and copy the text manually.');
      }
      
      function copyWithExecCommand() {
        elements.jsonOutput.select();
        const success = document.execCommand('copy');
        
        if (success) {
          const originalText = elements.copyJson.textContent;
          elements.copyJson.textContent = '✅ Copied!';
          
          setTimeout(() => {
            elements.copyJson.textContent = originalText;
          }, 2000);
        } else {
          alert('Copy failed. Please select and copy the text manually.');
        }
      }
    });

    // Initialize
    renderEmbeds();
    renderButtons();
    renderPreview();
    updateJSON();
  </script>
  >
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Sortable.js for drag and drop -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
</body>
</html>
